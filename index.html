<!doctype html>
<html lang="sv">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tr√§ningsapp ‚Äî Redigerbart schema</title>
<style>
:root{--bg:#f7f7fb;--card:#ffffff;--primary:#1f2937;--muted:#6b7280;--accent:#2563eb}
*{box-sizing:border-box}
body{font-family:Inter, Roboto, Arial, sans-serif; margin:0; background:var(--bg); color:var(--primary)}
header{background:linear-gradient(90deg,#eef2ff,#fff); padding:14px 16px; text-align:center; border-bottom:1px solid #e6e9ef}
header h1{margin:0; font-size:18px}
nav{display:flex; gap:6px; padding:10px; justify-content:space-around; background:transparent; position:sticky; top:0; z-index:10}
nav button{flex:1; padding:10px 8px; border-radius:10px; border:0; background:transparent; color:var(--primary); cursor:pointer}
nav button.active{background:#fff; box-shadow:0 1px 4px rgba(0,0,0,0.06); border:1px solid #e6e9ef}
.container{padding:12px; max-width:900px; margin:0 auto}
.card{background:var(--card); padding:12px; border-radius:10px; box-shadow:0 1px 4px rgba(0,0,0,0.04); margin-bottom:12px}
h2{margin:6px 0 10px 0}
.small{font-size:13px; color:var(--muted)}
input[type="number"], input[type="date"], select, input[type="text"]{padding:8px; font-size:14px; border-radius:6px; border:1px solid #e6e9ef; width:100%}
.button{display:inline-block; padding:10px; border-radius:8px; background:var(--accent); color:white; border:0; cursor:pointer; width:100%}
.row{display:flex; gap:8px}
.set-row{display:flex; gap:8px; align-items:center; margin-bottom:6px}
.set-row input{flex:1}
.previous-log{font-size:13px; color:var(--muted); margin-bottom:6px}
.exercise-row{display:flex; justify-content:space-between; align-items:center; padding:8px 0; border-bottom:1px dashed #efefef}
.select-inline{display:flex; gap:8px; margin-bottom:8px}
.select-inline select{flex:1}
.editor-grid{display:grid; grid-template-columns:1fr; gap:8px}
@media (min-width:700px){ .row {flex-direction:row} .editor-grid{grid-template-columns:1fr 1fr} }
</style>
</head>
<body>
<header><h1>Tr√§ningsapp ‚Äî Redigerbart schema</h1></header>
<nav id="nav">
  <button id="tab-bank" class="active">√ñvningsbank</button>
  <button id="tab-program">Program</button>
  <button id="tab-log-program">Logga program</button>
  <button id="tab-history">Historik</button>
</nav>

<div class="container">
  <section id="section-bank" class="card">
    <h2>√ñvningsbank</h2>
    <input id="search-input" type="text" placeholder="S√∂k √∂vning..." />
    <div style="height:8px"></div>
    <div id="exercise-list"></div>
    <div style="height:8px"></div>
    <input id="new-ex" type="text" placeholder="L√§gg till egen √∂vning..." />
    <div style="height:8px"></div>
    <button class="button" onclick="addExercise()">L√§gg till √∂vning</button>
  </section>

  <section id="section-program" class="card" style="display:none">
    <h2>Program</h2>
    <div id="next-pass" class="card" style="margin-bottom:12px; display:none"></div>

    <div style="display:flex; gap:8px; margin-bottom:8px">
      <button class="button" style="width:auto" onclick="loadDefaultWeek('A')">Vecka A (standard)</button>
      <button class="button" style="width:auto" onclick="loadDefaultWeek('B')">Vecka B (standard)</button>
    </div>

    <h3>Redigera schema</h3>
    <div class="small">V√§lj ett schema att visa/redigera och tryck Spara f√∂r att spara ditt personliga schema.</div>
    <div style="height:8px"></div>
    <div class="select-inline">
      <select id="select-week" onchange="showEditableWeek(this.value)">
        <option value="A">Vecka A (egen)</option>
        <option value="B">Vecka B (egen)</option>
      </select>
      <button class="button" style="width:auto" onclick="resetToDefault()">√Öterst√§ll standard</button>
    </div>

    <div id="editor" class="editor-grid"></div>
    <div style="height:8px"></div>
    <button class="button" onclick="saveCustomSchema()">üíæ Spara schema</button>
  </section>

  <section id="section-log-program" class="card" style="display:none">
    <h2>Logga program</h2>
    <div id="log-info" class="small">V√§lj ett program i Program-fliken eller tryck Starta n√§sta pass.</div>
    <div id="log-program-area"></div>
    <div style="height:8px"></div>
    <label>Datum</label>
    <input id="log-date" type="date" />
    <div style="height:8px"></div>
    <button class="button" onclick="saveProgram()">üíæ Spara program</button>
  </section>

  <section id="section-history" class="card" style="display:none">
    <h2>Historik</h2>
    <div id="history-area"></div>
    <div style="height:10px"></div>
    <button class="button" style="background:#ef4444" onclick="clearHistory()">Rensa historik</button>
  </section>
</div>

<script>
// --- Data & defaults ---
const exerciseBankDefault = ["B√§nkpress","Lutande hantelpress","Hantelflyes","Br√∂stpress i maskin","Kabelcross","Marklyft","Skivst√•ngsrodd","Pull-ups","Latsdrag","Facepulls","Roddmaskin","Kn√§b√∂j","Utfall","Benpress","Raka marklyft","Vadpress","Plankan","Situps","Ryska vridningar","Milit√§rpress","Hantellyft √•t sidan","Hantellyft fram","Omv√§nda flyes","Bicepscurl","Hammercurl","Triceps pushdown","Dips","French press"];

// Default schema: Dag 1..5 for week A and B
const defaultSchema = {
  A: {
    "Dag 1": ["B√§nkpress","Lutande hantelpress","Hantelflyes"],
    "Dag 2": ["Marklyft","Skivst√•ngsrodd","Pull-ups"],
    "Dag 3": ["Kn√§b√∂j","Benpress","Plankan"],
    "Dag 4": ["Milit√§rpress","Hantellyft √•t sidan","Omv√§nda flyes"],
    "Dag 5": ["Bicepscurl","Triceps pushdown","Dips"]
  },
  B: {
    "Dag 1": ["Lutande b√§nkpress","Br√∂stpress i maskin","Kabelcross"],
    "Dag 2": ["Latsdrag","Facepulls","Roddmaskin"],
    "Dag 3": ["Utfall","Raka marklyft","Benlyft"],
    "Dag 4": ["Hantellyft fram","Milit√§rpress med hantlar","Omv√§nda flyes"],
    "Dag 5": ["Hammercurl","French press","Bicepscurl"]
  }
};

// Load or init data
let exerciseBank = JSON.parse(localStorage.getItem('exerciseBank')) || exerciseBankDefault.slice();
let customSchema = JSON.parse(localStorage.getItem('customSchema')) || JSON.parse(JSON.stringify(defaultSchema));
let nextPass = JSON.parse(localStorage.getItem('nextPass')) || { week: 'A', dayIndex: 1 }; // dayIndex 1..5
let currentWeekView = 'A';
let currentDayView = null;

// Helpers
function $(id){ return document.getElementById(id) }
function todayISO(){ const d=new Date(); d.setMinutes(d.getMinutes()-d.getTimezoneOffset()); return d.toISOString().slice(0,10) }

// Navigation
const tabs = { bank: $('tab-bank'), program: $('tab-program'), logProgram: $('tab-log-program'), history: $('tab-history') };
const sections = { bank: $('section-bank'), program: $('section-program'), logProgram: $('section-log-program'), history: $('section-history') };
function setActive(tabKey){
  for(let t in tabs) tabs[t].classList.remove('active');
  for(let s in sections) sections[s].style.display='none';
  tabs[tabKey].classList.add('active');
  sections[tabKey].style.display='block';
  if(tabKey==='program'){ renderNextPass(); showEditableWeek(currentWeekView); }
  if(tabKey==='logProgram'){ if(currentDayView) loadLogProgram(currentWeekView, currentDayView); else $('log-program-area').innerHTML='<div class="small">V√§lj ett program i Program-fliken f√∂rst eller Starta n√§sta pass.</div>'; $('log-date').value = todayISO(); }
  if(tabKey==='history'){ renderHistory(); }
}
tabs.bank.addEventListener('click', ()=> setActive('bank'));
tabs.program.addEventListener('click', ()=> setActive('program'));
tabs.logProgram.addEventListener('click', ()=> setActive('logProgram'));
tabs.history.addEventListener('click', ()=> setActive('history'));
setActive('bank');

// Render exercise bank
function renderExerciseList(filter=''){
  const container = $('exercise-list'); container.innerHTML='';
  const f = filter.trim().toLowerCase();
  exerciseBank.forEach(ex => {
    if(!f || ex.toLowerCase().includes(f)){
      const div = document.createElement('div'); div.className='exercise-row';
      div.innerHTML = '<div>'+ex+'</div><div class="small">Senaste: '+getLatestSimple(ex)+'</div>';
      container.appendChild(div);
    }
  });
}
$('search-input').addEventListener('input', e=> renderExerciseList(e.target.value));

function addExercise(){
  const v = $('new-ex').value.trim(); if(!v) return alert('Skriv ett namn f√∂r √∂vningen'); exerciseBank.push(v); localStorage.setItem('exerciseBank', JSON.stringify(exerciseBank)); $('new-ex').value=''; renderExerciseList();
}

function getLatestSimple(ex){
  const logs = JSON.parse(localStorage.getItem('logs')||'[]').filter(l=>l.exercise===ex);
  if(!logs.length) return '-';
  const last = logs[logs.length-1];
  return `${last.weight||'-'}kg √ó ${last.reps||'-'} (set ${last.set||1})`;
}

// --- Program / Editor ---
function renderNextPass(){
  const el = $('next-pass');
  const week = nextPass.week;
  const dayIndex = nextPass.dayIndex;
  const dayKey = 'Dag ' + dayIndex;
  el.style.display = 'block';
  el.innerHTML = `<strong>Ditt n√§sta pass:</strong> Vecka ${week} ‚Äî ${dayKey}<div style="height:8px"></div>
                  <div style="display:flex; gap:8px"><button class="button" style="width:auto" onclick="startNextPass()">Starta n√§sta pass</button><button class="button" style="width:auto; background:#6b7280" onclick="skipNextPass()">Skjut upp (n√§sta dag)</button></div>`;
}

function skipNextPass(){
  // increment nextPass without opening
  advanceNextPass();
  alert('N√§sta pass skjuts fram till Vecka ' + nextPass.week + ' ' + ('Dag ' + nextPass.dayIndex));
  renderNextPass();
}

function startNextPass(){
  currentWeekView = nextPass.week;
  currentDayView = 'Dag ' + nextPass.dayIndex;
  setActive('logProgram');
  loadLogProgram(currentWeekView, currentDayView);
}

// Show editable week in editor
function showEditableWeek(week){
  currentWeekView = week;
  $('select-week').value = week;
  const editor = $('editor'); editor.innerHTML='';
  const schema = customSchema[week];
  for(let i=1;i<=5;i++){
    const dayKey = 'Dag ' + i;
    const dayCard = document.createElement('div'); dayCard.className='card';
    const title = document.createElement('div'); title.innerHTML = `<strong>${dayKey}</strong><div class="small" style="margin-bottom:6px">Byt √∂vningar f√∂r denna dag</div>`;
    dayCard.appendChild(title);
    // three selects
    for(let s=0;s<3;s++){
      const sel = document.createElement('select');
      exerciseBank.forEach(ex => {
        const opt = document.createElement('option'); opt.value = ex; opt.text = ex; sel.appendChild(opt);
      });
      sel.value = (schema[dayKey] && schema[dayKey][s]) ? schema[dayKey][s] : exerciseBank[0];
      const label = document.createElement('div'); label.className='select-inline';
      const lblText = document.createElement('div'); lblText.style.minWidth='70px'; lblText.textContent = '√ñvning ' + (s+1) + ':';
      const wrapper = document.createElement('div'); wrapper.style.flex='1';
      wrapper.appendChild(sel);
      label.appendChild(lblText); label.appendChild(wrapper);
      dayCard.appendChild(label);
    }
    editor.appendChild(dayCard);
  }
}

// Save custom schema from editor
function saveCustomSchema(){
  const editor = $('editor');
  const selects = editor.querySelectorAll('select');
  const week = $('select-week').value;
  const schema = JSON.parse(JSON.stringify(customSchema));
  let idx = 0;
  for(let day=1; day<=5; day++){
    const dayKey = 'Dag ' + day;
    schema[week][dayKey] = [];
    for(let s=0;s<3;s++){
      const sel = selects[idx++];
      schema[week][dayKey].push(sel.value);
    }
  }
  customSchema = schema;
  localStorage.setItem('customSchema', JSON.stringify(customSchema));
  alert('Ditt schema sparades f√∂r Vecka ' + week);
  showEditableWeek(week);
}

// Reset to default
function resetToDefault(){
  if(!confirm('√Öterst√§lla standardprogram? Ditt sparade schema f√∂r Vecka A/B kommer tas bort.')) return;
  customSchema = JSON.parse(JSON.stringify(defaultSchema));
  localStorage.removeItem('customSchema');
  alert('Standardprogram √•terst√§llda');
  showEditableWeek(currentWeekView);
}

// Load default week into editor (for convenience)
function loadDefaultWeek(week){
  customSchema[week] = JSON.parse(JSON.stringify(defaultSchema[week]));
  localStorage.setItem('customSchema', JSON.stringify(customSchema));
  alert('Standardprogram laddat till Vecka ' + week + ' (du kan nu redigera och spara)');
  showEditableWeek(week);
}

// --- Logga program (3 set per exercise) ---
function loadLogProgram(week, dayKey){
  currentWeekView = week; currentDayView = dayKey;
  const area = $('log-program-area'); area.innerHTML='';
  const schema = customSchema[week];
  if(!schema || !schema[dayKey]){ area.innerHTML = '<div class="small">Inget program hittades f√∂r denna dag.</div>'; return; }
  const exList = schema[dayKey];
  exList.forEach(ex => {
    const card = document.createElement('div'); card.className='card';
    card.innerHTML = `<h3>${ex}</h3>`;
    const logs = JSON.parse(localStorage.getItem('logs')||'[]').filter(l=>l.exercise===ex);
    if(logs.length){
      const last = logs[logs.length-1];
      card.innerHTML += `<div class="previous-log">Senaste: ${last.weight||'-'} kg √ó ${last.reps||'-'} reps (set ${last.set||1})</div>`;
    } else {
      card.innerHTML += `<div class="previous-log">Senaste: -</div>`;
    }
    for(let s=1;s<=3;s++){
      const div = document.createElement('div'); div.className='set-row';
      div.innerHTML = `Set ${s}: Vikt <input class="set-weight" type="number" data-ex="${ex}" data-set="${s}" placeholder="kg"> Reps <input class="set-reps" type="number" data-ex="${ex}" data-set="${s}" placeholder="reps">`;
      card.appendChild(div);
    }
    area.appendChild(card);
  });
  $('log-date').value = todayISO();
}

// Save program and update nextPass
function saveProgram(){
  if(!currentDayView) return alert('V√§lj ett program f√∂rst.');
  const date = $('log-date').value || todayISO();
  const area = $('log-program-area');
  const cards = area.querySelectorAll('.card');
  let logs = JSON.parse(localStorage.getItem('logs')||'[]');
  cards.forEach(card => {
    const ex = card.querySelector('h3').innerText;
    const sets = card.querySelectorAll('.set-row');
    sets.forEach((sr, idx) => {
      const w = sr.querySelector('.set-weight').value;
      const r = sr.querySelector('.set-reps').value;
      if(w || r){
        logs.push({ exercise: ex, weight: w, reps: r, date: date, set: idx+1, week: currentWeekView, day: currentDayView });
      }
    });
  });
  localStorage.setItem('logs', JSON.stringify(logs));
  if(currentWeekView === nextPass.week && currentDayView === ('Dag ' + nextPass.dayIndex)){
    advanceNextPass();
  }
  alert('Program sparat i historiken!');
  renderHistory();
}

// Advance nextPass (wraps A<->B)
function advanceNextPass(){
  let w = nextPass.week;
  let d = nextPass.dayIndex;
  d++;
  if(d>5){ d=1; w = (w==='A')? 'B' : 'A'; }
  nextPass = { week: w, dayIndex: d };
  localStorage.setItem('nextPass', JSON.stringify(nextPass));
  renderNextPass();
}

// --- History ---
function renderHistory(){
  const area = $('history-area'); area.innerHTML='';
  const logs = JSON.parse(localStorage.getItem('logs')||'[]');
  if(!logs.length){ area.innerHTML = '<div class="small">Ingen historik √§nnu.</div>'; return; }
  const byDate = {};
  logs.forEach(l=>{ if(!byDate[l.date]) byDate[l.date]=[]; byDate[l.date].push(l); });
  const dates = Object.keys(byDate).sort((a,b)=> b.localeCompare(a));
  dates.forEach(date => {
    const card = document.createElement('div'); card.className='card';
    const header = document.createElement('div'); header.innerHTML = `<strong>${date}</strong>`;
    card.appendChild(header);
    const list = document.createElement('div');
    byDate[date].forEach(item => {
      const div = document.createElement('div'); div.style.padding='6px 0'; div.style.borderBottom='1px dashed #efefef';
      div.innerHTML = `<div style='font-weight:600'>${item.exercise} <span style='font-weight:400; color:var(--muted)'> (${item.week? item.week+' '+item.day : 'ingen info'}) set ${item.set||1})</span></div>
                       <div class='small'>${item.weight? item.weight+' kg √ó '+item.reps+' reps' : 'Ej ifyllt'}</div>`;
      list.appendChild(div);
    });
    card.appendChild(list); area.appendChild(card);
  });
}

// Clear history
function clearHistory(){ if(confirm('Rensa all historik?')){ localStorage.removeItem('logs'); renderHistory(); alert('Historik raderad'); } }

// Init UI
renderExerciseList();
showEditableWeek('A');
renderNextPass();
$('log-date').value = todayISO();
renderHistory();
</script>
</body>
</html>
